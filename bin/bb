#!/usr/bin/env ruby

while (index = ARGV.index('-I'))
  _,path = ARGV.slice!(index, 2)
  $: << path
end

# TBD tmp for testing
$: << ::File.join(::File.dirname(__FILE__), "../../oj/lib")
$: << ::File.join(::File.dirname(__FILE__), "../../oj/ext")
$: << ::File.join(::File.dirname(__FILE__), "../../oterm/lib")
$: << ::File.join(::File.dirname(__FILE__), "../lib")

require 'optparse'

require 'oj'
require 'balancebook'

$verbose = false

# TBD look for config or -c option
#  location of data file and any other options other than -c

# TBD args are commands like 'report'
# bb report late-penalty
#  metod on invoice for days_to_pay
#  if 90 <= d2p then calc penalty based on 1.5% / 30 days

opts = OptionParser.new(%{Usage: bb [options] <json_data_file>

Does stuff...
})
opts.on('-v', 'verbose')                      { $verbose = true }
opts.on('-h', '--help', 'Show this display')  { puts opts.help; Process.exit!(0) }
files = opts.parse(ARGV)

if 1 != files.size
  puts opts.help
  Process.exit!(0)
end

company = Oj.load_file(File.expand_path(files[0]))

rep = BalanceBook::Report::LateReport.new(company)

rep.display

File.open("late.csv", 'w') { |f|
  rep.csv(f)
}
